cd ~/logos-platform/scripts

# Backup the original
cp sync-local-db.sh sync-local-db.sh.backup

# Create updated script
cat > sync-local-db.sh << 'EOF'
#!/bin/bash
set -e

# Default to local database
DB_URL="${DATABASE_URL:-postgresql://postgres:Mycat%4095@localhost:5432/logos_platform}"

# Allow override from command line argument
if [ ! -z "$1" ]; then
  DB_URL="$1"
  echo "üåê Using provided database URL"
else
  echo "üè† Using local database"
fi

MIGRATIONS_DIR="apps/backend/src/database/migrations"

echo "=========================================="
echo "üóÑÔ∏è  LOGOS Platform Database Migration Tool"
echo "=========================================="
echo "üìÅ Migrations directory: $MIGRATIONS_DIR"
echo ""

# Test connection
echo "üîå Testing database connection..."
if psql "$DB_URL" -c "SELECT 1" > /dev/null 2>&1; then
  echo "‚úÖ Database connection successful"
else
  echo "‚ùå Database connection failed"
  exit 1
fi

echo ""
echo "üß© Running migrations..."
echo "=========================================="

# Run migrations in order
for file in $(ls -v $MIGRATIONS_DIR/*.sql); do
  filename=$(basename "$file")
  echo "üìÑ Applying: $filename"
  
  if psql "$DB_URL" -f "$file" > /dev/null 2>&1; then
    echo "   ‚úÖ Success"
  else
    echo "   ‚ö†Ô∏è  Warning: May have already been applied or contains errors"
  fi
done

echo "=========================================="
echo "‚úÖ All migrations completed!"
echo ""
echo "üìä Database tables:"
psql "$DB_URL" -c "\dt"

echo ""
echo "üéâ Migration process complete!"
EOF

chmod +x sync-local-db.sh

echo "‚úÖ Script updated!"
echo ""
echo "Usage:"
echo "  Local:  ./sync-local-db.sh"
echo "  Render: ./sync-local-db.sh 'YOUR_RENDER_DATABASE_URL'"
echo ""
echo "Example with Render:"
echo "  ./sync-local-db.sh 'postgresql://user:pass@host:5432/dbname'"
